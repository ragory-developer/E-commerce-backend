// ========================================
// AUTO-GENERATED FILE â€” DO NOT EDIT
// Run: npm run prisma:build
// ========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


// ========================================
// MODULE:  00-ENUMS.PRISMA
// ========================================

enum AuthUserType {
  ADMIN
  CUSTOMER
}

enum Role {
  SUPERADMIN
  ADMIN
}

enum Permission {
  // User Management
  MANAGE_USERS
  VIEW_USERS

  // Product Management
  MANAGE_PRODUCTS
  VIEW_PRODUCTS

  // Order Management
  MANAGE_ORDERS
  VIEW_ORDERS

  // Payment Management
  MANAGE_PAYMENTS
  VIEW_PAYMENTS

  // Reports
  VIEW_REPORTS
  EXPORT_DATA

  // Settings
  MANAGE_SETTINGS
}

enum OtpChannel {
  EMAIL
  SMS
}

enum OtpPurpose {
  VERIFY_EMAIL
  VERIFY_PHONE
  RESET_PASSWORD
  TWO_FACTOR_AUTH
  LOGIN_OTP
}


// ========================================
// MODULE:  ADMIN.PRISMA
// ========================================

model Admin {
  id            String        @id @default(cuid())

  firstName     String        @db.VarChar(50)
  lastName      String        @db.VarChar(50)
  email         String        @unique @db.VarChar(255)
  phone         String?        @db.VarChar(20)
  avatar        String?

  password      String

  role          Role          @default(ADMIN)
  permissions   Permission[]  @default([])

  tokens        AuthToken[]

  isActive      Boolean       @default(true)
  isDeleted     Boolean       @default(false)
  deletedAt     DateTime?
  lastLoginAt   DateTime?
  lastLoginIp   String?       @db.VarChar(45)

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  createdBy     String?

  @@index([email])
  @@index([role])
  @@index([isActive, isDeleted])
  @@map("admins")
}


// ========================================
// MODULE:  AUDITLOG.PRISMA
// ========================================

model AuditLog {
  id          String   @id @default(cuid())

  actorRole   Role
  actorId     String?

  action      String
  model       String
  recordId   String?

  oldData     Json?
  newData     Json?

  ipAddress   String?
  userAgent   String?

  createdAt   DateTime @default(now())

  @@index([actorRole])
  @@index([actorId])
  @@index([model])
}


// ========================================
// MODULE:  AUTH-TOKEN.PRISMA
// ========================================

model AuthToken {
  id            String       @id @default(cuid())

  userType      AuthUserType

  adminId       String?
  admin         Admin?       @relation(fields: [adminId], references: [id], onDelete: Restrict)

  customerId    String?
  customer      Customer?    @relation(fields: [customerId], references: [id], onDelete: Restrict)

  tokenHash     String       @db.VarChar(255)
  expiresAt     DateTime

  revoked       Boolean      @default(false)
  revokedAt     DateTime?
  revokedReason String?      @db.VarChar(100)

  deviceInfo    String?      @db.VarChar(255)
  ipAddress     String?      @db.VarChar(45)
  userAgent     String?      @db.Text

  createdAt     DateTime     @default(now())

  @@index([tokenHash])
  @@index([userType])
  @@index([adminId])
  @@index([customerId])
  @@index([expiresAt])
  @@index([revoked])
  @@map("auth_tokens")
}


// ========================================
// MODULE:  CUSTOMER.PRISMA
// ========================================

model Customer {
  id              String    @id @default(cuid())

  firstName       String?    @db.VarChar(50)
  lastName        String?   @db.VarChar(50)

  email           String?    @unique @db.VarChar(255)
  emailVerified   Boolean   @default(false)
  phone           String    @unique @db.VarChar(20)
  phoneVerified   Boolean   @default(false)

  password        String?

  avatar          String?
  dateOfBirth     DateTime?
  gender          String?   @db.VarChar(20)

  addresses       Json      @default("[]")

  tokens          AuthToken[]

  isGuest         Boolean   @default(true)
  isActive        Boolean   @default(true)
  isDeleted       Boolean   @default(false)
  deletedAt       DateTime?

  lastLoginAt     DateTime?
  lastLoginIp     String?   @db.VarChar(45)

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([email])
  @@index([phone])
  @@index([isActive, isDeleted])
  @@map("customers")
}


// ========================================
// MODULE:  VERIFICATION-OTP.PRISMA
// ========================================

model VerificationOtp {
  id          String      @id @default(cuid())

  channel     OtpChannel
  purpose     OtpPurpose

  target      String      @db.VarChar(255)

  codeHash    String      @db.VarChar(255)
  expiresAt   DateTime

  attempts    Int         @default(0)
  maxAttempts Int         @default(5)

  verified    Boolean     @default(false)
  verifiedAt  DateTime?

  ipAddress   String?     @db.VarChar(45)
  userAgent   String?     @db.Text

  createdAt   DateTime    @default(now())

  @@index([target])
  @@index([channel, purpose])
  @@index([expiresAt])
  @@map("verification_otp")
}
